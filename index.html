<style>
    body,
    html {
        font-size: 16px;
        font-family: 'Microsoft Sans Serif', Arial, Helvetica, sans-serif;
        --light-grey: #ccc;
        --grey: #bababa;
    }

    .spacer {
        flex: 1;
        min-width: 4rem;
    }

    .window {
        display: inline-block;
        position: absolute;
        border: 2px outset var(--light-grey);
        background-color: var(--grey);
    }

    .window-header {
        display: flex;
        background-image: linear-gradient(to right, #010081, #62b3f1);
        padding: 0.25rem;
        align-items: flex-end;
        cursor: pointer;
    }

    .window-title {
        color: #fff;
        font-weight: 700;
        margin-left: 0.25rem;
    }

    .window-content {
        padding: 0.75rem;
        border: 2px inset var(--light-grey);
        /* margin: 2px 1px 1px; */
        background-color: #fff;
        overflow: hidden;
        white-space: nowrap;
    }

    .window button {
        border-radius: 0;
        border: 2px outset var(--light-grey);
        background-color: var(--grey);
        cursor: pointer;
        margin-left: 0.25rem;
    }
    .window button[disabled] {
        cursor: not-allowed;
    }
</style>
<html>

<head>
    <link href="https://fonts.cdnfonts.com/css/microsoft-sans-serif" rel="stylesheet">
</head>

<body>
    <div class="content">
        <div id="sidewalk" class="window" style="width:195px">
            <div class="window-header">
                <span class="window-title">Sidewalk</span>
                <span class="spacer"></span>
                <button disabled>O</button>
                <button disabled>X</button>
            </div>
            <div class="window-content">
                ðŸª±ðŸª±ðŸª±ðŸŒ±ðŸŒ±ðŸª±
            </div>
        </div>
        <div id="garden" class="window" style="width:180px">
            <div class="window-header">
                <span class="window-title">Garden</span>
                <span class="spacer"></span>
                <button disabled>O</button>
                <button disabled>X</button>
            </div>
            <div class="window-content">
                dirt dirt dirt<br>
                dirt dirt ðŸª±<br>
                dirt dirt dirt
            </div>
        </div>
    </div>


    <script>
        const MARGIN = 10;
        const SPEED = 300;
        const INTERACTIONS = {
            garden: {
                sidewalk: {
                    position: "right",
                    run: async () => { 
                        const sidewalkWindow = document.getElementById("sidewalk");
                        sidewalkWindow.classList.add("done");

                        const sidewalkContent = sidewalkWindow.getElementsByClassName("window-content")[0];
                        const gardenContent = document.getElementById("garden").getElementsByClassName("window-content")[0];
                        for (let i = 0; i < 7; i++) {
                            sidewalkContent.innerHTML = `ðŸª±ðŸª±ðŸª±ðŸŒ±ðŸŒ±${spacer(3 * i)}ðŸª±`;
                            await timeout(SPEED);
                        }
                        sidewalkContent.innerHTML = `ðŸª±ðŸª±ðŸª±ðŸŒ±ðŸŒ±`;
                        gardenContent.innerHTML = "dirt ðŸª± dirt<br>dirt dirt ðŸª±<br>dirt dirt dirt"
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `ðŸª±ðŸª±  ðŸª±ðŸŒ±`;
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `ðŸª±ðŸª±  ðŸŒ±ðŸª±`;
                        await timeout(SPEED);
                        for (let i = 0; i < 8; i++) {
                            sidewalkContent.innerHTML = `ðŸª±ðŸª±  ðŸŒ±ðŸŒ±${spacer(3 * i)}ðŸª±`;
                            await timeout(SPEED);
                        }
                        sidewalkContent.innerHTML = `ðŸª±ðŸª±  ðŸŒ±ðŸŒ±`;
                        gardenContent.innerHTML = "dirt ðŸª± ðŸª±<br>dirt dirt ðŸª±<br>dirt dirt dirt"
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `${spacer(2)}ðŸª±ðŸª±ðŸŒ±ðŸŒ±`;
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `${spacer(4)}ðŸª±ðŸª±ðŸŒ±`;
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `${spacer(6)}ðŸª±ðŸª±`;
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `${spacer(6)}ðŸŒ±ðŸª±ðŸª±`;
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `${spacer(6)}ðŸŒ±ðŸŒ±ðŸª±ðŸª±`;
                        await timeout(SPEED);
                        for (let i = 0; i < 6; i++) {
                            sidewalkContent.innerHTML = `${spacer(6)}ðŸŒ±ðŸŒ±${spacer(3 * i)}ðŸª±ðŸª±`;
                            await timeout(SPEED);
                        }
                        sidewalkContent.innerHTML = `${spacer(6)}ðŸŒ±ðŸŒ±${spacer(21)}ðŸª±`;
                        gardenContent.innerHTML = "dirt ðŸª± ðŸª±<br>dirt dirt ðŸª±<br>dirt ðŸª± dirt"
                        await timeout(SPEED);
                        sidewalkContent.innerHTML = `${spacer(6)}ðŸŒ±ðŸŒ±`;
                        gardenContent.innerHTML = "dirt ðŸª± ðŸª±<br>ðŸª± dirt ðŸª±<br>dirt ðŸª± dirt";
                    }
                }
            },
        };
        
        function timeout(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        };

        function spacer(count) {
            return new Array(count).fill("&nbsp;").join("");
        }

        (function () {
            let currentWindow =  undefined;
            let mouseOffset = [0, 0];
            let zIndex = 1;
            const windows = document.getElementsByClassName("window");
            for (let w of windows) {
                w.style.left = 20 + Math.random() * 500;
                w.style.top = 20 + Math.random() * 200;

                const header = w.getElementsByClassName("window-header")[0];
                header.addEventListener('mousedown', (e) => {
                    e.preventDefault()
                    currentWindow = w;
                    mouseOffset[0] =  e.offsetX;
                    mouseOffset[1] =  e.offsetY;
                    zIndex += 1;
                    currentWindow.style.zIndex = zIndex;
                })
                document.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    checkInteractions(currentWindow);
                    currentWindow = undefined; 
                })
                document.addEventListener('mousemove', (e) => {
                    if (!!currentWindow) {
                        e.preventDefault()
                        currentWindow.style.left = e.clientX - mouseOffset[0];
                        currentWindow.style.top = e.clientY - mouseOffset[1];
                    }
                })
            }

            const checkInteractions = (targetWindow) => {
                if (!!targetWindow) {
                    for (let w of windows) {
                        const first = w.id < targetWindow.id ? w : targetWindow;
                        const second = w.id < targetWindow.id ?  targetWindow : w;
                        const interaction = INTERACTIONS[first.id]?.[second.id]
                        if (!!interaction && getRelativePosition(first, second) == interaction.position && !first.classList.contains("done") && !second.classList.contains("done")) {
                            interaction.run();
                        }
                    }
                }
            }

            // Position of w1 RELATIVE TO w2
            // [w1] [w2] -> "left"
            const getRelativePosition = (w1, w2) => {
                const rect1 = w1.getBoundingClientRect();
                const rect2 = w2.getBoundingClientRect();
                // TODO maybe work margin into top/bottom check
                if (((rect1.top > rect2.top && rect1.bottom < rect2.bottom) || (rect2.top > rect1.top && rect2.bottom < rect1.bottom))
                    && Math.abs(rect1.right - rect2.left) < MARGIN) {
                        return "left"
                } else if (((rect1.top > rect2.top && rect1.bottom < rect2.bottom) || (rect2.top > rect1.top && rect2.bottom < rect1.bottom))
                    && Math.abs(rect1.left - rect2.right) < MARGIN) {
                        return "right"
                } else if (((rect1.left > rect2.left && rect1.right < rect2.right) || (rect2.left > rect1.left && rect2.right < rect1.right))
                    && Math.abs(rect1.bottom - rect2.top) < MARGIN) {
                        return "top"
                } else if (((rect1.left > rect2.left && rect1.right < rect2.right) || (rect2.left > rect1.left && rect2.right < rect1.right))
                    && Math.abs(rect1.top - rect2.bottom) < MARGIN) {
                        return "bottom"
                } else {
                        return undefined;
                }
            }
        })();
    </script>
</body>

</html>